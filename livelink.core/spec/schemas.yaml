Vec2:
  title: Vec2
  type: array
  items:
    type: number
    format: float32
  minItems: 2
  maxItems: 2

Vec2i:
  title: Vec2i
  type: array
  items:
    type: number
    format: int32
  minItems: 2
  maxItems: 2

Vec2ui16:
  title: Vec2ui16
  type: array
  items:
    type: number
    format: uint16
  minItems: 2
  maxItems: 2

Vec3:
  title: Vec3
  type: array
  items:
    type: number
    format: float32
  minItems: 3
  maxItems: 3

Quaternion:
  title: Quaternion
  type: array
  items:
    type: number
    format: float32
  minItems: 4
  maxItems: 4

Mat4x4:
  title: Mat4x4
  type: array
  items:
    type: number
    format: float32
  minItems: 16
  maxItems: 16

RTID:
  type: integer
  format: uint64

UUID:
  type: string
  format: uuid

DataObject:
  type: object

EntityList:
  type: array
  items:
    $ref: "#/RTID"

Component:
  type: object
  properties:
    local_transform:
      type: object
      properties:
        position:
          $ref: "#/Vec3"
        orientation:
          $ref: "#/Quaternion"
        scale:
          $ref: "#/Vec3"

Entity:
  type: array
  items:
    anyOf:
      - $ref: "#/Component"

ScreenSpaceRayResult:
  type: object
  properties:
    entity_rtid:
      $ref: "#/RTID"
    position:
      $ref: "#/Vec3"
    normal:
      $ref: "#/Vec3"

ScreenSpaceRayQuery:
  type: object
  properties:
    camera_rtid:
      $ref: "#/RTID"
    pos:
      $ref: "#/Vec2"
    mode:
      type: integer
      format: uint8

HighlightEntities:
  type: object
  properties:
    entities:
      $ref: "#/EntityList"
    keep_old_selection:
      type: boolean

SessionAuth:
  type: object
  properties:
    session_key:
      type: string
    client_app:
      type: string
      example: "Hololens 2"
    os:
      type: string
      example: "Win32"

ClientConfigResponse:
  type: object
  properties:
    codec:
      type: integer
      format: int8

ClientConfig:
  type: object
  properties:
    remote_canvas_size:
      type: array
      items:
        type: integer
        minimum: 16
        maximum: 3840
        multipleOf: 4
      minItems: 2
      maxItems: 2
    encoder_config:
      type: object
      properties:
        codec:
          type: integer
          default: 0
        profile:
          type: integer
          default: 0
        frame_rate:
          type: integer
          default: 30
        lossy:
          type: boolean
          default: true
        mp4:
          type: boolean
          default: false
    input_devices:
      type: object
      properties:
        has_keyboard:
          type: boolean
        has_mouse:
          type: boolean
        has_hololens:
          type: boolean
        has_gamepad:
          type: boolean
        has_touchscreen:
          type: boolean

AuthenticationStatus:
  oneOf:
    - title: Unknown error
      type: integer
      format: int16
      const: 0

    - title: Success
      type: integer
      format: int16
      const: 1

    - title: Authentication failed
      type: integer
      format: int16
      const: 100
    - title: Session not found
      type: integer
      format: int16
      const: 101
    - title: Session closed
      type: integer
      format: int16
      const: 102

    - title: Launcher not found
      type: integer
      format: int16
      const: 200
    - title: Unknown service
      type: integer
      format: int16
      const: 201
    - title: Service boot error
      type: integer
      format: int16
      const: 202

    - title: Invalid request
      type: integer
      format: int16
      const: 300
    - title: Duplicated session
      type: integer
      format: int16
      const: 301

    - title: Client not found
      type: integer
      format: int16
      const: 400

AuthenticationResponse:
  type: object
  properties:
    status:
      $ref: "#/AuthenticationStatus"
    client_id:
      type: string
      format: uuid

FrameData:
  title: VideoFrame
  type: object
  properties:
    encoded_frame_size:
      type: integer
      format: int32
    meta_data_size:
      type: integer
      format: int32
    encoded_frame:
      type: string
      format: binary
      x-size: encoded_frame_size
    meta_data:
      allOf:
        - $ref: "#/FrameMetaData"
        - x-size: meta_data_size

FrameMetaData:
  title: FrameMetaData
  type: object
  properties:
    renderer_timestamp:
      type: integer
      format: uint32
    frame_counter:
      type: integer
      format: uint32
    client_count:
      type: integer
      format: uint8
    clients:
      type: array
      items:
        $ref: "#/ClientMetaData"
      x-size: "client_count"

ClientMetaData:
  title: ClientMetaData
  type: object
  properties:
    client_id:
      type: string
      format: uuid
    viewport_count:
      type: integer
      format: uint8
    viewports:
      type: array
      items:
        $ref: "#/ViewportMetaData"
      minItems: 8
      maxItems: 8
      x-size: "viewport_count"

ViewportMetaData:
  title: ViewportMetaData
  type: object
  properties:
    camera_rtid:
      $ref: "#/RTID"
    ws_from_ls:
      $ref: "#/Mat4x4"

ViewportConfig:
  title: ViewportConfig
  type: object
  properties:
    left:
      type: number
      format: float32
    top:
      type: number
      format: float32
    width:
      type: number
      format: float32
    height:
      type: number
      format: float32
    camera_rtid:
      $ref: "#/RTID"

ViewportsConfig:
  title: ViewportsConfig
  type: object
  properties:
    viewport_count:
      type: integer
      format: uint8
    viewports:
      type: array
      items:
        $ref: "#/ViewportConfig"

Resize:
  title: Resize
  type: object
  properties:
    size:
      $ref: "#/Vec2ui16"

ResizeResponse:
  title: ResizeResponse
  type: object
  properties:
    new_size:
      $ref: "#/Vec2ui16"

InputState:
  title: InputState
  type: object
  properties:
    input_operation:
      type: integer
      format: uint8
    data:
      type: string
      format: binary

ScriptEvent:
  title: ScriptEvent
  type: object
  properties:
    emitter_rtid:
      title: The entity that emitted the event
      $ref: "#/RTID"
    event_name:
      type: string
    entity_rtids:
      type: array
      items:
        $ref: "#/RTID"
    data_object:
      type: object

FireEvent:
  title: FireEvent
  type: object
  properties:
    event_map_id:
      title: The event map from where the event comes from.
      $ref: "#/UUID"
    event_name:
      title: The name of the event to fire. Must exist in the event map.
      type: string
    entities:
      title: |
        The entities on which to fire the event. If empty the event fires for
        all listening entities.
      $ref: "#/EntityList"
    data_object:
      title: The data object containing the payload of the event.
      $ref: "#/DataObject"

UpdateAnimationSequenceState:
  title: UpdateAnimationSequenceState
  type: object
  properties:
    linker_rtid:
      title: The linker under which the animation sequence is located.
      $ref: "#/RTID"
    animation_sequence_id:
      title: The UUID of the target animation sequence.
      $ref: "#/UUID"
    state:
      title: The state to apply to the target animation sequence.
      oneOf:
        - const: play
        - const: pause
        - const: stop
    playback_speed:
      title: The playback speed to apply to the target animation sequence.
      type: number
      format: float32
      default: 1
    seek_offset:
      title: The normalized offset to seek relative to the start of the sequence.
      type: number
      format: float32
      default: 0
  required: [linker_rtid, animation_sequence_id, state, playback_speed]

AssignClientToScript:
  title: AssignClientToScript
  type: object
  properties:
    client_uuid:
      title: The client UUID to assign to the script.
      $ref: "#/UUID"
    script_uuid:
      title: The script to which to assign the client UUID.
      $ref: "#/UUID"
    entity_rtid:
      title: The entity to which the script is attached.
      $ref: "#/RTID"
  required: [client_uuid, script_uuid, entity_rtid]

UpdateEntitiesFromJson:
  title: UpdateEntitiesFromJson
  type: object
  properties:
    component_count:
      type: number
      format: uint32
    components:
      type: array
      items:
        minItems: 1
        type: object
        properties:
          component_hash:
            type: number
            format: uint32
          entity_count:
            type: number
            format: uint32
          entity_rtids:
            $ref: "#/EntityList"
          entities:
            type: array
            items:
              minItems: 1
              type: object
              $ref: "#/Entity"

RemoveComponents:
  title: RemoveComponents
  type: object
  properties:
    component_count:
      type: number
      format: uint32
    components:
      type: array
      items:
        minItems: 1
        type: object
        properties:
          component_hash:
            type: number
            format: uint32
          entity_count:
            type: number
            format: uint32
          entity_rtids:
            $ref: "#/EntityList"
